<!DOCTYPE html>
<html>

<head>
    <title>TADS - Prova OSW</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        tituto {
            color: red;
        }

        .titulo {
            color: green;
        }

        #titulo {
            color: blue;
        }

        [titulo] {
            color: yellow;
        }
    </style>
</head>

<body>
    <div>
        <hi id="titulo">TADS - Prova DSW - Carros</hi>
        <table>
            <thead>
                <tr>
                    <th>Modelo</th>
                    <th>Fabricante</th>
                    <th>Ano lancamento</th>
                </tr>
            </thead>
            <tbody id="resultado">
            </tbody>
        </table>

        <div>
            <p id="carregando">Carregando...</p>
            <p id="json"></p>
        </div>
    </div>

    <script>
        const carregandoP = document.getElementById('carregando');
        const jsonP = document.getElementById('json');

        function montarHtml(dados) {
            return '<tr>' +
                '<td>' + dados.modelo + '</td>' +
                '<td>' + dados.fabricante + '</td>' +
                '<td>' + dados.anoLancamento + '</td>' +
                '</tr>';
        }

        function getJson(url) {
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();
                xhr.open('GET', url, true);

                xhr.onload = function () {
                    if (xhr.status === 200) {
                        resolve(JSON.parse(xhr.responseText));
                    } else {
                        reject({
                            codigo: xhr.status,
                            mensagem: 'Erro ao carregar dados',
                        });
                    }
                }
                xhr.send()
            })
        }

        async function listar() {
            try {
                const dados = await getJson('http://localhost:8080/carros/lista')

                // ADO 3
                carregandoP.style.display = 'none';
                jsonP.innerHTML = JSON.stringify(dados);
                // 

                for (let i = 0; i < dados.length; i++) {
                    const dadosHtml = montarHtml(dados[i]);
                    document.getElementById('resultado')
                        .insertAdjacentHTML('beforeend', dadosHtml);
                }
            } catch (err) {
                alert('ERRO:' + err.codigo + " " + err.mensagem);
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            console.log("dom called")
            listar();
        });
    </script>

</body>

</html>